{% extends "./wrapper.html" %}{% load actionkit_tags %}{% load smartif %}

{% block content %}
<!-- @START donate.html -->
{% if page.custom_fields.recurring_donation_popup %}
<div id="recurringModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
	<h1 style="color: #2893AC;" id="modalIntro">Thank you for your support!</h1>
	<p style="font-size: 1.5rem;">With your monthly gift of $<span id="recurring_donation_suggest">0.00</span>, we can help fight the constant attacks on Alaska's wild lands and waters. Thank you for keeping Alaska wild!</p>
	<h2 style="font-size: 1.5rem; text-align: center;" id="modalTitle"><strong>Would you consider becoming a <span style="color: #2893AC;">Wild Star monthly donor?</span></strong></h2>
		<div style="text-align: center;" class="row">
			<div class="large-12 columns">
				<button type="submit" id="recurring_submit" class="button" value="">No thanks, process my one-time $<span id="real_amount">0.00</span> gift</button>
			</div>
			<div class="large-12 columns">
				<input type="button" id="recurring_confirm" class="button" value="Yes! I'll be a Wild Star Donor!"></input>
			</div>
		</div>
	<a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>
{% endif %}

<script language="javascript">
	function clear_radio_buttons() {
		$('input.amount_radio_button').attr('checked', false);
	}

	function clear_other() {
		$('#amount_other_field').val("");
	}

	var address_fields = [ 'address1', 'addressdesk2', 'city','state', 'zip' {% if page.allow_international %},'postal', 'region', 'country'{% endif %} ];

	function toggle_shipping(e) {
		for (i in address_fields) {
			field = address_fields[i];

			if (e.checked) {
				$('#shipping_' + field).val($('#' + field).val());
				$('#id_shipping_state').val($('#id_state').val());
				$('#shipping_' + field).attr("readonly", true);
			} else {
				$('#shipping_' + field).val("");
				$('#id_shipping_state').val("");
				$('#shipping_' + field).attr("readonly", false);
			}
		}

		{% if page.allow_international %}
			shipping_country_change();
		{% endif %}
	}

	function sync_to_shipping(e) {
		if (!$('#shipping_same').attr("checked"))
			return;

		for (i in address_fields) {
			field = address_fields[i];

			$('#shipping_' + field).val($('#' + field).val());
			$('#id_shipping_state').val($('#id_state').val());
		}

		{% if page.allow_international %}
			shipping_country_change();
		{% endif %}
	}

	function update_total() {
		var total = 0.0;

		$('.ak_product_inputs').each(function (i) {
			// max == 1 produces checkboxes for these
			if (this.type == "checkbox" && !this.checked)
				return;

			// check that quantity is a valid int
			var quantity = this.value;

			if (quantity.length == 0 || !/^[1-9]\d*$/.test(quantity))
				return;

			// and price is a valid dollar amount
			var price = $('#' + this.id + '_price').text();

			// Remove any currency formatting
			price = Number(price.replace(/[^0-9\.]+/g,""));

			if (price.length == 0 || !/^[1-9]\d*(\.\d\d)?$/.test(price))
				return;

			total += parseInt(quantity) * parseFloat(price);
		});

		$('.ak_candidate_inputs').each(function (i) {
			// check that amount is a valid amount
			var amount = this.value;

			if (amount.length == 0 || !/^[0-9]\d*(\.\d\d)?$/.test(amount))
				return;

			total += parseFloat(amount);
		});

		// look for checked off donation amounts
		var amount_checked = $('input:radio[name=amount]:checked').val(); 

		if (amount_checked) {
			total += parseFloat(amount_checked);
		} else {
			// or other amounts
			var other = $('#amount_other_field').val();

			if (other && /^[0-9]\d*(\.\d{2})?$/.test(other))
				total += parseFloat(other);
		}

		// Set the amount so GA can easily get it
		$('#ga-amount').val(total.toFixed(2));

		var new_total = total == 0 ? "" : '$' + total.toFixed(2);

		if (new_total != $('#total').html()) {
			$('#total').html(new_total);
		}
		
	}

	{% if page.allow_international %}
		function country_change() {
			country = $('#country').val();

			if (country == 'United States') {
				$('#us_billing_fields').show();
				$('#intl_billing_fields').hide();
			} else {
				$('#us_billing_fields').hide();
				$('#intl_billing_fields').show();
			}

			sync_to_shipping();
		}

		function shipping_country_change() {
			shipping_country = $('#shipping_country').val();

			if (shipping_country == 'United States') {
				$('#us_shipping_fields').show();
				$('#intl_shipping_fields').hide();
			} else {
				$('#us_shipping_fields').hide();
				$('#intl_shipping_fields').show();
			}
		}
	{% endif %}
</script>


{% comment %}
	/*
-------------------------------------------------------------------------------
		@START - Google Analytics Tracking
-------------------------------------------------------------------------------
	*/
{% endcomment %}
<script>
	/*
		Function to make GA events for problems during donating
	*/
	function logValidationErrors() {
		$('#ak-errors li').each(function() {
			var errorMessage = $(this).html();

			if(errorMessage.length > 0 && errorMessage != "For your security, your card number has been cleared.") {
				if(knownUser) {
					ga( 'send', 'event', 'Validation Error', '{{ user.email }}', errorMessage, {{ page.id }} );
				} else if ( $('#email').val() != "" ) {
					ga( 'send', 'event', 'Validation Error', $('#email').val(), errorMessage, {{ page.id }} );
				} else {
					ga( 'send', 'event', 'Validation Error', 'Unknown User', errorMessage, {{ page.id }} );
				}
				
				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Validation Error', $.cookie('user') + ': ' + errorMessage + " on {{ page.id }}", {{ page.id }} );			
					ga( 'send', 'event', 'Cookie', $.cookie('user'), 'Validation Error: ' + errorMessage + " on {{ page.id }}", {{ page.id }} );			
				}
				
				//if error message, clear processing fees checkbox
				$('input[name="include_fees"]').attr('checked', false);
			
			}
		});
	}

	$(document).ready(function() {
		// Set up tracking events on form submit
		$('#act').submit(function() {
			{% if page.custom_fields.splash_page %}
				if( $(this).valid() ) {
			{% endif %}
				if(knownUser) {
					ga('send', 'event', 'Submission Attempt', '{{ user.email }}', 'Amount (' + $('#ga-amount').val() + ')', {{ page.id }});
					ga('send', 'event', 'Submission Attempt', '{{ user.email }}', 'Type (' + $('input[name="donation_type"]:checked').val() + ')', {{ page.id }});	
				} else if ( $('#email').val() != "" ) {
					ga('send', 'event', 'Submission Attempt', $('#email').val(), 'Amount (' + $('#ga-amount').val() + ')', {{ page.id }});
					ga('send', 'event', 'Submission Attempt', $('#email').val(), 'Type (' + $('input[name="donation_type"]:checked').val() + ')', {{ page.id }});	
				} else {
					ga('send', 'event', 'Submission Attempt', 'Unknown User', 'Amount (' + $('#ga-amount').val() + ')', {{ page.id }});
					ga('send', 'event', 'Submission Attempt', 'Unknown User', 'Type (' + $('input[name="donation_type"]:checked').val() + ')', {{ page.id }});
				}

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga('send', 'event', 'Cookie', 'Submission Attempt', $.cookie('user') + ' on {{ page.id }} for ' + $('#ga-amount').val() + ' (' + $('input[name="donation_type"]:checked').val() + ')');
					ga('send', 'event', 'Cookie', $.cookie('user'), 'Submission Attempt on {{ page.id }} for ' + $('#ga-amount').val() + ' (' + $('input[name="donation_type"]:checked').val() + ')');
				}
			{% if page.custom_fields.splash_page %}
				}
			{% endif %}
		});

		// Set up tracking for donation type change
		$('input[name="donation_type"]').change(function() {
			if( $(this).is(':checked') ) {
				if(knownUser) {
					ga( 'send', 'event', 'Form Interaction', '{{ user.email }}', 'Type Changed (' + $(this).val() + ')', {{ page.id }} );
				} else if ( $('#email').val() != "" ) {
					ga( 'send', 'event', 'Form Interaction', $('#email').val(), 'Type Changed (' + $(this).val() + ')', {{ page.id }} );
				} else {
					ga('send', 'event', 'Form Interaction', 'Unkown User', 'Type Changed ('+ $(this).val() + ')', {{ page.id }} );
				}			

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Form Interaction', 'Type Changed (' + $.cookie('user') + ' to ' + $(this).val() + ')', {{ page.id }});
					ga( 'send', 'event', 'Cookie', $.cookie('user'),  'Type Changed to ' + $(this).val() + ' on {{ page.id }}', {{ page.id }});
				}
			}
		});

		// Track "next" button clicked
		$('.next').click(function() {
			var page = $(this).data('page');
			{% if page.custom_fields.splash_page %}
				if($('#act').valid()) {
			{% endif %}
				if(knownUser) {
					ga('send', 'event', 'Form Interaction', '{{ user.email }}', 'Next Pressed (' + (page - 1) + ')');
				} else if ( $('#email').val() != "" ) {
					ga('send', 'event', 'Form Interaction', $('#email').val(), 'Next Pressed (' + (page - 1) + ')');
				} else {
					ga('send', 'event', 'Form Interaction', 'Unknown User', 'Next Pressed (' + (page - 1) + ')');
				}

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Form Interaction', 'Next Pressed (' + $.cookie('user') + ' on {{ page.id }})', {{ page.id }});
					ga( 'send', 'event', 'Cookie', $.cookie('user'),  'Form Interfaction - Next Pressed {{ page.id }}', {{ page.id }});			
				}
			{% if page.custom_fields.splash_page %}
				} else {
			{% endif %}
				logValidationErrors();

				if ( typeof $.cookie('user') !== 'undefined') { 
					ga( 'send', 'event', 'Cookie', 'Form Interaction', 'Next Pressed w/ Errors (' + $.cookie('user') + ' on {{ page.id }})', {{ page.id }});
					ga( 'send', 'event', 'Cookie', $.cookie('user'),  'Form Interfaction - Next Pressed w/ Errors {{ page.id }}', {{ page.id }});			
				}
			{% if page.custom_fields.splash_page %}
				}
			{% endif %}
		});

		// Track "prev" button clicked
		$('.prev').click(function() {
			var page = $(this).data('page');

			if(knownUser) {
				ga('send', 'event', 'Form Interaction', '{{ user.email }}', 'Back Pressed (' + (page + 1) + ')');
			} else if ( $('#email').val() != "" ) {
				ga('send', 'event', 'Form Interaction', $('#email').val(), 'Back Pressed (' + (page + 1) + ')');
			} else {
				ga('send', 'event', 'Form Interaction', 'Unknown User', 'Back Pressed (' + (page + 1) + ')');
			}
		});

		// Log any errors that AK spits back
		window.setTimeout(function() {
			logValidationErrors();
		}, 500);
	});
</script>
{% comment %}
	/*
-------------------------------------------------------------------------------
		@END - Google Analytics Tracking
-------------------------------------------------------------------------------
	*/
{% endcomment %}

{% if page.custom_fields.splash_page %}
	{% comment %}
		/*
			---------------------------------------------------------------
				START - Staged Donation Form - Javascript
			---------------------------------------------------------------
		*/
	{% endcomment %}

	<script language="javascript" src="//ajax.aspnetcdn.com/ajax/jquery.validate/1.13.1/jquery.validate.min.js"></script>
	<script language="javascript" src="//ajax.aspnetcdn.com/ajax/jquery.validate/1.13.1/additional-methods.min.js"></script>

	<script>
		function getURLParameter(name) {
			return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
		}

		$(document).ready(function() {
			/*
				---------------------------------------------------------------
					Resubmission - If this is a resubmission, go to page 3
				---------------------------------------------------------------
			*/

			var page_to_show = 1;

			if ( window.location.href.indexOf("error_card_num") >= 0) {
				page_to_show = 3;
			} 

			if(page_to_show > 1) {
				$('.page-1').hide();
				$('.page-' + page_to_show).show();
			}

			/*
				Add class to radio button label [Based on original AK function]
			*/
			$('.amounts input[name="amount"], .amounts input#amount_other_field').click(function() {
				// Remove any labels that were marked at checked
				$('.amounts label.checked').removeClass('checked'); 

				// Add the label radio-checked
				$(this).parent('label').addClass('checked');
			});


			/*
				---------------------------------------------------------------
					Forward / Back Buttons
				---------------------------------------------------------------
			*/

			$('.next').click(function() {
				var page = $(this).data('page');
				var button = $(this);

				if($('#act').valid()) {			
					$(button).prop('disabled', true);

					$('.page-' + (page - 1)).fadeOut(300, function() {
						$('.page-' + page).delay(50).fadeIn(300, function() {
							$(button).prop('disabled', false);
						});
					});
				}
			});

			$('.prev').click(function() {
				var page = $(this).data('page');
				var button = $(this);
					
				$(button).prop('disabled', true);

				$('.page-' + (page + 1)).fadeOut(300, function() {
					$('.page-' + page).delay(50).fadeIn(300, function() {
						$(button).prop('disabled', false);
					});
				});
			});


			/*
				---------------------------------------------------------------
					Populate form off URL Parameters
				---------------------------------------------------------------
			*/

			setTimeout(function() {
				if( getURLParameter('amount') ) {
					$('#id_amount_' + getURLParameter('amount')).parent('label').addClass('checked');
				}

				if( getURLParameter('donation_type') == "recurring") {
					$('#id_type_monthly').prop('checked', true);

					$('.type label.checked').removeClass('checked');

					$('#id_type_monthly').parent('label').addClass('checked');
				}

				if( getURLParameter('state') ) {
					$('#id_state').val( getURLParameter('state') );

					$('label[for="id_state"]').addClass("has-content");
				}

				if( getURLParameter('zip') ) {
					$('#zip').val( getURLParameter('zip') );

					$('label[for="zip"]').addClass("has-content");
				}
			}, 250);

			
			/*
				---------------------------------------------------------------
					If AK has a suggested ask, properly highlight it
				---------------------------------------------------------------
			*/
			
			$('input[type="radio"]:checked', '.amounts').prop('checked', false).click();


			/*
				---------------------------------------------------------------
					Overlaid Label Javascript. Borrows heavily from actionkit.js
				---------------------------------------------------------------
			*/

			function checkContent(field) {
				var label = $("label[for='"+$(this).attr('id')+"']");

				var is_select = $(this).prop("selectedIndex");

				if( $(this).val() || is_select) {
					label.addClass("has-content");
				} else {
					label.removeClass("has-content");
				}
			}

			$('.splash-layout input[type="text"], .splash-layout select').focus(function() {
				var label = $("label[for='"+$(this).attr('id')+"']");

				label.addClass("focus");
			}).blur(function() {
				var label = $("label[for='"+$(this).attr('id')+"']");

				label.removeClass("focus");
			}).bind('keydown', function() {
				var label = $("label[for='"+$(this).attr('id')+"']");

				label.addClass("has-content");
			}).bind('dragenter', function() {
				label.addClass("has-content");
			}).bind('dragleave', function() {
					setTimeout(function() {
						checkContent(this);
					},1);
			}).bind('change', checkContent).bind('keyup', checkContent);


			/*
				---------------------------------------------------------------
					Form Submission
				---------------------------------------------------------------
			*/

			$('#act').submit(function() {
				if( $(this).valid() ) {
					$('.submit').prop('disabled', true).val("Processing...");
				}
			});


			/*
				---------------------------------------------------------------
					Validation
				---------------------------------------------------------------
			*/
			$('#act').validate({
				rules: {
					amount: {
						require_from_group: [1, '.amount-list']
					},

					amount_other: {
						require_from_group: [1, '.amount-list']
					},

					first_name: {
						required: true
					},

					last_name: {
						required: true
					},

					email: {
						required: true,
						email: true
					},

					address1: {
						required: true
					},

					city: {
						required: true
					},                 

					zip: {
						required: true,
						zipcodeUS: true
					},

					state: {
						required: true
					},

					card_numx: {
						required: true,
						creditcard: true
					},

					card_code: {
						required: true
					},

					exp_date_month: {
						required: true
					},

					exp_date_year: {
						required: true
					}
				},

				groups: {
					amountList: 'amount amount_other'
				},

				messages: {
					amount: {
						require_from_group: 'Select an amount.'
					},

					amount_other: {
						require_from_group: 'Select an amount.'
					},

					first_name: {
						required: 'Enter your first name.'
					},

					last_name: {
						required: 'Enter your last name.'
					},

					email: {
						required: 'Enter a valid email address.',
						email: 'Enter a valid email address.'
					},

					address1: {
						required: 'Enter your address.'
					},

					city: {
						required: 'Enter your city.'
					},                 

					state: {
						required: 'Select your state.'
					},

					zip: {
						required: 'Enter a valid ZIP code.',
						zipcodeUS: 'Enter a valid zip code.'
					},

					card_num: {
						required: "Enter your credit card number.",
						creditcard: "Enter a valid credit card number."
					},

					card_code: {
						required: "Enter your CVV code."
					},

					exp_date_month: {
						required: "Select your card's month of expiration."
					},

					exp_date_year: {
						required: "Select your card's year of expiration."
					}   
				},

				errorElement: 'li',
				errorClass: 'form-error',
				errorLabelContainer: "#ak-errors",

				highlight: function(element, errorClass, validClass) {
					var label = $("label[for='"+$(element).attr('id')+"']");

					$(label).addClass("has-error");
				},

				unhighlight: function(element, errorClass, validClass) {
					var label = $("label[for='"+$(element).attr('id')+"']");

					$(label).removeClass("has-error");
				}
			});			
		});
	</script>
	{% comment %}
		/*
			---------------------------------------------------------------
				END - Staged Donation Form - Javascript
			---------------------------------------------------------------
		*/
	{% endcomment %}
{% endif %}

{% if not page.custom_fields.disable_paypal %}
	{% if page.custom_fields.donation_template_2 or page.custom_fields.donation_template_3 or page.custom_fields.donation_template_4  or page.custom_fields.splash_page %}
		<script>
			$(document).ready(function() {
				/*
					Get the AKID (if it exists)
				*/
				$('#akid').val(getURLParameter('akid'));


				/*
					Paypal button override to tack on the amount the user selected
				*/
				$('#paypal-button').click(function(e) {
					e.preventDefault();

					var amount = $('#total').html();

					amount = amount.substring(1);

					$('#amount_list').html();

					$('#paypal-amount').val(amount);

					$('#paypal-form').submit();
				});
			});

			/*
				Get a value from the url for a given parameter
			*/
			function getURLParameter(name) {
			     return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
			}
		</script>
	{% endif %}
{% endif %}

{% if page.custom_fields.splash_page %}
	{% comment %}
		/*
			---------------------------------------------------------------
				START - Staged Donation Form - Markup
			---------------------------------------------------------------
		*/
	{% endcomment %}
	<div class="medium-24 columns alternate-layout splash-layout">
		<form id="act" name="act" class="donate-form{% if page.payment_processor_information.use_tr %} braintree_form{% endif %}" method="POST" action="/act/" accept-charset="utf-8">
			<input type="hidden" name="page" value="{{ page.name }}">                         
			<input type="hidden" name="ga-amount" id="ga-amount" value="0">
			<input type="hidden" name="orig_akid" value="{{ akid }}">
			<input type="radio" id="id_type_single" name="donation_type" value="single" class="hidden" checked>
			<input type="hidden" name="recurring_start" value="{% now "Y-m-d" %}">

			<div class="hidden">
				<div id="total"></div>
			</div>

			<div class="row">
				<div class="page-title medium-20 medium-offset-2 columns">
					<h2>{{ page.title }}</h2>
				</div> <!-- .page-title -->
			</div>

			<div class="row">
				<div class="medium-9 columns form-error-box-wrapper">
					<ul id="ak-errors" class="form-error-box">		
					</ul> <!-- .form-error-box -->
				</div> <!-- .form-error-box-wrapper -->

				<div class="medium-10 medium-offset-3 columns donate-pane">
					{% comment %}
						/*
							---------------------------------------------------------------
								START - Staged Donation Form - Step #1 (Amounts)
							---------------------------------------------------------------
						*/
					{% endcomment %}
						<div id="step-1" class="donation-page page-1 amount-form">
							<div class="ask-text">
								{% include_tmpl form.ask_text %}
							</div> <!-- .ask-text -->

							<div class="row amounts">
								{% for amount in amounts %}
									{% ifequal amount "other" %}
										<div class="small-8 columns amount-other">
											<noscript><input type="radio" value="" class="amount_radio_button" name="amount"></noscript>
											<label for="amount_other_field" class="ak-btn radio">
												{{ page.currency_sym }}<input type="text" id="amount_other_field" class="amount-list" name="amount_other" size="3" onKeypress="clear_radio_buttons();" onClick="update_total()" onBlur="update_total()" onChange="update_total()">
											</label>
										</div>
									{% else %}
										<div class="small-8 columns">
											<label for="id_amount_{{amount}}" class="ak-btn radio">
												<input type="radio" id="id_amount_{{amount}}" value="{{ amount }}" class="amount_radio_button amount-list" name="amount" onClick="clear_other(); update_total()"  onBlur="update_total()" onChange="update_total()" {% if not args.amount_other and amount == default_amount %}checked{% endif %}>{{ page.currency_sym }}{{ amount|commify }}
											</label>
										</div>
									{% endifequal %}
								{% endfor %}
							</div>
							
							<div class="page-buttons row">
								<div class="{% if not page.custom_fields.disable_paypal %}medium-11 {% endif %}small-22 small-offset-1 columns donate-button">
									<input type="button" class="medium button next" value="Donate!" data-page="2"/>
								</div>

								{% if not page.custom_fields.disable_paypal %}
									<div class="small-22 medium-11 small-offset-1 medium-offset-0 columns paypal">
										<a id="paypal-button" class="button">
											<span class="paypal-small">Donate with</span><span class="paypal-large">PayPal</span>
										</a>
									</div> <!-- .paypal -->
								{% endif %}
							</div> <!-- .page-buttons -->
						</div> <!-- .page-1 -->
					{% comment %}
						/*
							---------------------------------------------------------------
								END - Staged Donation Form - Step #1
							---------------------------------------------------------------
						*/
					{% endcomment %}

					{% comment %}
						/*
							---------------------------------------------------------------
								START - Staged Donation Form - Step #2 (User Form)
							---------------------------------------------------------------
						*/
					{% endcomment %}
						<div id="step-2" class="donation-page page-2 user-form">
							<div class="row">
								<div class="user-form ak-labels-overlaid">
									<div class="medium-12 columns">
										<label for="first_name"><span id="first_namereq" class="first_namereq req">*</span>First Name</label> 
										<input id="first_name" type="text" name="first_name" />
									</div>

									<div class="medium-12 columns">
										<label for="last_name"><span id="last_namereq" class="last_namereq req">*</span>Last Name</label> 
										<input id="last_name" type="text" name="last_name" />
									</div>

									<div class="medium-24 columns">
										<label class="required" for="email">Email</label>
										<input id="email" type="text" name="email" />
									</div>

									{% if has_shippable_products %}
										<div class="medium-24 columns">
											<label for="address1">Billing Address</label>
											<input id="address1" type="text" name="address1" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
										</div>

										<div class="medium-24 columns">
											<label for="address2">Billing Address (optional)</label>
											<input id="address2" type="text" name="address2" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
										</div>
									{% else %}
										<div class="medium-24 columns">
											<label for="address1">Billing Address</label>
											<input id="address1" type="text" name="address1" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
										</div>
									{% endif %}

									<div class="medium-8 columns">
										<label for="city">City</label>
										<input id="city" type="text" name="city" onchange="sync_to_shipping()" onblur="sync_to_shipping()" />
									</div>

									{% if page.allow_international %}
										<div id="us_billing_fields">
									{% endif %}

									<div class="medium-10 columns">
										<label class="invisible" for="id_state">State</label>
										{% with 'sync_to_shipping()' as onchange %}{% include "./state_select.html" %}{% endwith %}
									</div>

									<div class="medium-6 columns">
										<label for="zip">Zip</label>
										<input id="zip" type="text" name="zip" maxlength="5" size="5" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
									</div>

									{% if page.allow_international %}
										</div>

										<div id="intl_billing_fields">
											<div class="medium-8 columns">
												<label for="region">Region</label>
												<input id="region"  type="text" name="region" size="20" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
											</div>
											
											<div class="medium-8 columns">
												<label for="postal">Postal Code</label>
												<input id="postal"  type="text" name="postal" size="10" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
											</div>
										</div>

										<div class="medium-24 columns">
											<label for="country">Country</label>
											{% with 'country_change()' as onchange %}{% include "./country_select.html" %}{% endwith %}
										</div>

										<script language="javascript">country_change();</script>
									{% endif %}
								</div> <!-- labels overlaid (billing address) -->					
							</div> <!-- .row -->

							<div class="page-buttons">
								<input type="button" class="small button prev secondary" value="&lt; Back" data-page="1"/>
								<input type="button" class="small button next" value="Next &gt;" data-page="3"/>
							</div> <!-- .page-buttons -->							
						</div> <!-- .page-2 -->
					{% comment %}
						/*
							---------------------------------------------------------------
								END - Staged Donation Form - Step #2
							---------------------------------------------------------------
						*/
					{% endcomment %}					

					{% comment %}
						/*
							---------------------------------------------------------------
								START - Staged Donation Form - Step #3 (Payment)
							---------------------------------------------------------------
						*/
					{% endcomment %}
						<div id="step-3" class="donation-page page-3 payment-form">
							<div class="row">
								<div class="medium-24 columns">
									<div id="ak-fieldbox-card_num" class="">
										<label for="ak-card_num">Credit Card #</label>
										<input type="hidden" name="required" value="card_num" id="ak-card_num-required">
										<div id="ak-card_num-hosted" class="hosted-field"></div>
										<input id="ak-card_num" type="text" name="card_num">
									</div>
								</div>
							</div> <!-- .row -->

							<div class="row">
								<div class="medium-12 columns">
									<div id="ak-fieldbox-exp_date">
										<input type="hidden" name="required" value="exp_date_month" id="ak-exp_date_month-required">
										<label for="ak-exp_date_month">Expiration Date</label>
										<div id="ak-exp_date-hosted" class="hosted-field"></div>
										<select id="ak-exp_date_month" type="text" name="exp_date_month">
											<option value="">MM</option>
											<option value="01">01</option>
											<option value="02">02</option>
											<option value="03">03</option>
											<option value="04">04</option>
											<option value="05">05</option>
											<option value="06">06</option>
											<option value="07">07</option>
											<option value="08">08</option>
											<option value="09">09</option>
											<option value="10">10</option>
											<option value="11">11</option>
											<option value="12">12</option>
										</select>
										<input type="hidden" name="required" value="exp_date_year" id="ak-exp_date_year-required">
										<select id="ak-exp_date_year" type="text" name="exp_date_year">
											<option value="">YYYY</option>
											{% for year in exp_years %}
											<option value="{{ year.two }}">{{ year.four }}</option>
											{% endfor %}
										</select>
									</div>
								</div> <!-- .medium-12 -->
								

								<div class="medium-4 columns">
									<div id="ak-fieldbox-card_code">
										<input type="hidden" name="required" value="card_code" id="ak-card_code-required">
										<label for="ak-card_code">Verification Code</label>
										<div id="ak-card_code-hosted" class="hosted-field"></div>
										<input id="ak-card_code" type="text" name="card_code" size="4">
									</div>
								</div> <!-- .medium-12 -->
							</div> <!-- .row -->

							<div class="row submit-button">
								<div class="medium-8 columns">
									<input type="button" class="small button prev secondary" value="&lt; Back" data-page="2"/>
								</div>

								<div class="medium-16 columns">
										{% if page.custom_fields.submit_button_text %}
											<input type="submit" class="button alert" value="{{page.custom_fields.submit_button_text}}" />
										{% else %}
											<input class="button alert" type="submit" value="Submit Donation">
										{% endif %}
		
									<div>{% include "./progress_meter.html" %}</div>
								</div>
							</div>
						</div> <!-- .page-3 -->
					{% comment %}
						/*
							---------------------------------------------------------------
								END - Staged Donation Form - Step #3
							---------------------------------------------------------------
						*/
					{% endcomment %}					
				</div> <!-- .medium-16 -->
			</div> <!-- .row -->	
		</form>
	</div> <!-- .alternate-layout -->

	{% if not page.custom_fields.disable_paypal %}
		<form id="paypal-form" action="https://www.paypal.com/cgi-bin/webscr" method="POST">
			<input type="hidden" name="cmd" value="_donations">
			
			<input type="hidden" name="on1" value="akid">
			<input type="hidden" id="akid" name="os1">
			
			<input type="hidden" name="on2" value="page_id">
			<input type="hidden" name="os2" value="{{ page.id }}">
			
			<input type="hidden" name="amount" id="paypal-amount">

			<input type="hidden" name="custom" value="{{ page.title }}">

			<input type="hidden" name="business" value="8YLRMFTTWHGB2">
			<input type="hidden" name="lc" value="US">
			<input type="hidden" name="item_name" value="Alaska Wilderness League">

			{% if page.custom_fields.paypal_thank_you_url %}
				<input type="hidden" name="return" value="{{ page.custom_fields.paypal_thank_you_url }}"> 
			{% else %}
				<input type="hidden" name="return" value="http://www.alaskawild.org/thank-you-for-your-support/"> 
			{% endif %}
		</form>
	{% endif %}
	{% comment %}
		/*
			---------------------------------------------------------------
				END - Staged Donation Form - Markup
			---------------------------------------------------------------
		*/
	{% endcomment %}
{% elif page.custom_fields.donation_template_2 or page.custom_fields.donation_template_3 or page.custom_fields.donation_template_4 %}
	{% comment %}
		/*
			---------------------------------------------------------------
				START - Alternate Layout Donation Form - Markup
			---------------------------------------------------------------
		*/
	{% endcomment %}
	<div class="medium-offset-5 medium-19 columns alternate-layout">
		<form id="act" name="act" class="donate-form{% if page.payment_processor_information.use_tr %} braintree_form{% endif %}" method="POST" action="/act/" accept-charset="utf-8">
			<input type="hidden" name="orig_akid" value="{{ akid }}">
			<input type="hidden" name="recurring_start" value="{% now "Y-m-d" %}">

			<div class="hidden">
				<div id="total"></div>
			</div>

			<div class="row">
				<div class="page-title medium-24 columns">
					<h2>{{ page.title }}</h2>
				</div> <!-- .page-title -->

				{% if page.custom_fields.donation_template_2 %}
					<div class="left-column medium-12 columns">
						<div class="row">
				{% endif %}

				{% if page.custom_fields.alternate_image %}
					<div class="image {% if page.custom_fields.donation_template_3 %}medium-12 {% else %}medium-24 {% endif %} columns">
						<img src="{{ page.custom_fields.alternate_image }}">
					</div> <!-- .image -->
				{% endif %}

				{% if page.custom_fields.donation_template_3 or page.custom_fields.donation_template_4 %}
					<div class="ask-text {% if page.custom_fields.donation_template_4 %}medium-24 {% else %}medium-12 {% endif %}hide-for-small columns">
						{% include_tmpl form.ask_text %}
					</div> <!-- .ask-text -->
				{% endif %}

				<div class="row">
					<div class="errors medium-24 columns">
						<ul id="ak-errors"></ul>
					</div>
				</div>

				<div class="amounts medium-24 columns">
					<div class="form-pretext">
						{% if page.custom_fields.custom_form_title %}
							{{ page.custom_fields.custom_form_title }}
						{% else %}
							Donate!
						{% endif %}
					</div> <!-- .form-pretext -->

					<!-- logic to enable most_people_are_giving solution -->
					{% if page.custom_fields.most_people_are_giving %}	
						{% if suggested_ask %}
						<div id="suggested_donation" style="margin-bottom: 2%;">
							<span style="font-size: 12px; color: #F57B20; border-bottom: 1px solid #F57B20;">Most people are donating <i class="fa fa-usd" aria-hidden="true"></i>{{ suggested_ask }} right now!</span>
						</div>
						{% else %}
						<div id="suggested_donation" style="margin-bottom: 2%;">
							<span style="font-size: 12px; color: #F57B20; border-bottom: 1px solid #F57B20;">Most people are donating <i class="fa fa-usd" aria-hidden="true"></i>{{ page.custom_fields.most_people_are_giving }} right now!</span>
						</div>
						{% endif %}
					{% endif %}
					
					{% if amounts %}
						<div id="amounts" class="row amount">
							{% for amount in amounts %}
								{% ifequal amount "other" %}
									<div class="{% if page.custom_fields.donation_template_3 %}medium-6 {% else %}medium-24 {% endif %} columns">
										<noscript><input type="radio" value="" class="amount_radio_button" name="amount"></noscript>
										Other $<input type="text" id="amount_other_field" name="amount_other" size="3" onFocus="clear_radio_buttons();" onClick="update_total()" onBlur="update_total()" onChange="update_total()">
									</div>
								{% else %}
									<div class="{% if page.custom_fields.donation_template_3 %}medium-3 {% else %}medium-6 {% endif %} columns">
										<input type="radio" value="{{ amount }}" class="amount_radio_button" name="amount" onClick="clear_other(); update_total();"  onBlur="update_total()" onChange="update_total()" {% if not args.amount_other and amount == default_amount %}checked{% endif %}>&nbsp;${{ amount }}
									</div>
								{% endifequal %}
							{% endfor %}
						</div> <!-- #amounts -->

						{% if not has_products %}
							{% if allow_monthly %}
								<div id="type" class="row">
									<div class="type-wrapper">
										<div class="small-12 {% if page.custom_fields.donation_template_3 %}medium-6 {% else %}medium-12 {% endif %}columns">
											<input type="radio" name="donation_type" value="single" checked> One-Time
										</div>

										<div id="donation_type_recurring" class="small-12 {% if page.custom_fields.donation_template_3 %}medium-6 {% else %}medium-12 {% endif %}columns">
											<input type="radio" name="donation_type" value="recurring"> Monthly
										</div>
									</div>

									<div class="hidden medium-24 columns paypal-type-notification">
										Yay! You've selected a one-time gift via PayPal. Click "Donate!" below to continue.
									</div>
								</div>
							{% else %}
								<input type="hidden" name="donation_type" value="single">
							{% endif %}
						{% endif %}
					{% endif %}
				</div> <!-- .amounts -->
				
					{% if page.custom_fields.processing_fees_text %}
						<!-- begin checkbox for processing fees -->
						<input type="checkbox" name="include_fees"><span class="include_fees_description">{{ page.custom_fields.processing_fees_text }}</span><br>
					{% endif %}

				{% if show_paypal %}
					<div class="payment-method medium-24 columns">
						<div class="row">
							<div class="medium-12 columns cc">
								<input type="radio" name="paypal" value="0" id="pay_by_cc" checked> 
								<label for="pay_by_cc" class="type-button"><span class="button small">Credit Card</span></label>
							</div>

							<div class="medium-12 columns paypal">
								<input type="radio" name="paypal" value="1" id="pay_by_paypal">
								<label for="pay_by_paypal" class="type-button paypal"><span class="button small">PayPal</span></label>
							</div>
						</div>
					</div>
				{% endif %}


				{% if page.custom_fields.donation_template_2 %}
						</div> <!-- .row -->
					</div> <!-- .left-column -->

					<div class="ask-text medium-12 hide-for-small columns">
						{% include_tmpl form.ask_text %}
					</div> <!-- .ask-text -->
				{% endif %}
			</div> <!-- .row -->

			<div class="row">
				<div class="user-form medium-12 columns">
					<div class="user-input box">               
						<div id="unknown_user"></div>

						<div>
							<div class="row">
								<div class="medium-12 columns">
									<label for="first_name"><span id="first_namereq" class="first_namereq req">*</span>First Name:</label> 
									<input id="first_name" type="text" name="first_name" />
								</div>

								<div class="medium-12 columns">
									<label for="last_name"><span id="last_namereq" class="last_namereq req">*</span>Last Name:</label> 
									<input id="last_name" type="text" name="last_name" />
								</div>
							</div> <!-- .row -->

							<div class="row">
								<div class="medium-24 columns">
									<label for="address1" class="address"><span id="address1req" class="address1req req"></span>Street:</label>
									<input id="address1" type="text" name="address1" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
								</div>
							</div> <!-- .row -->

							{% if page.allow_international %}
								<div id="us_billing_fields" class="row">
									<div class="medium-12 columns">
										<label for="state" class="state-label"><span id="statereq" class="statereq req">State</span>:</label> 
										{% with 'sync_to_shipping()' as onchange %}
											{% include "./state_select.html" %}
										{% endwith %}
									</div>

									<div class="medium-12 columns">
										<label for="zip" class="zip-label"><span id="zipreq" class="zipreq req"></span>Zip:</label>  
										<input id="zip"  type="text" name="zip" maxlength="5" size="5" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
									</div>
								</div> <!-- #us_billing_fields -->

								<div id="intl_billing_fields" class="row">                 
									<div class="medium-12 columns">
										<label for="state" class="state-label"><span id="regionreq" class="regionreq req"></span>Region:</label> 
										<input id="region"  type="text" name="region" size="20" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
									</div>

									<div class="medium-12 columns">
										<label for="postal" class="zip-label"><span id="postalreq" class="postalreq req"></span>Postal Code:</label>  
										<input id="postal"  type="text" name="postal" size="10" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
									</div>
								</div> <!-- #intl_billing_fields -->

								<div class="row">
									<div class="medium-24 columns">
										<label for="state"><span id="countryreq" class="countryreq req"></span>Country:</label> 
										{% with 'country_change()' as onchange %}
											{% include "./country_select.html" %}
										{% endwith %}
									</div>
								</div> <!-- .row -->

								<script language="javascript">country_change();</script>
							{% else %}
								<div class="row">
									<div class="medium-12 columns">
										<label for="city" class="city-label"><span id="cityreq" class="cityreq req"></span>City:</label> 
										<input id="city" type="text" name="city" onchange="sync_to_shipping()" onblur="sync_to_shipping()" />
									</div>

									<div class="medium-6 columns">
										<label for="state" class="state-label"><span id="statereq" class="statereq req"></span>State:</label> 
										{% with 'sync_to_shipping()' as onchange %}
											{% include "./state_select.html" %}
										{% endwith %}
									</div>

									<div class="medium-6 columns">
										<label for="zip" class="zip-label"><span id="zipreq" class="zipreq req"></span>Zip:</label>  
										<input id="zip"  type="text" name="zip" maxlength="5" size="5" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
									</div>                    
								</div> <!-- .row -->
							{% endif %}

							<div class="row">
								<div class="medium-24 columns">
									<label for="email"><span id="emailreq" class="emailreq req"></span>Email:</label> 
									<input id="email" type="text" name="email" />
									<input type="hidden" name="required" value="email"/>

									<div class="subscription-notice notifcation">
										<p>If you donate now and are not already a member, you will receive periodic email communications from Alaska Wilderness League.</p>
									</div> <!-- .subscription-notice -->
								</div>
							</div> <!-- .row -->

							<div style="clear"></div>
						</div>
				
						{% autoescape off %}
							{% if page.custom_fields.custom_field %}
								<div class="clear"></div>

								<div class="custom_field">
									{{page.custom_fields.custom_field}}

									<div class="clear"></div>
								</div>
							{% endif %}
						{% endautoescape %}

						<input type="hidden" name="page" value="{{ page.name }}">
					</div><!-- .user_input -->
				</div> <!-- .user-form -->

				<div class="medium-12 cc-info columns">
					<div class="payment-form">
						<div class="row">
							<div class="medium-24 columns">
								<div id="ak-fieldbox-card_num" class="">
									<label for="ak-card_num">Credit Card #</label>
									<input type="hidden" name="required" value="card_num" id="ak-card_num-required">
									<div id="ak-card_num-hosted" class="hosted-field"></div>
									<input id="ak-card_num" type="text" name="card_num">
								</div>
							</div>
						</div> <!-- .row -->

						<div class="row">
							<div class="medium-12 columns">
								<div id="ak-fieldbox-exp_date">
									<input type="hidden" name="required" value="exp_date_month" id="ak-exp_date_month-required">
									<label for="ak-exp_date_month">Expiration Date</label>
									<div id="ak-exp_date-hosted" class="hosted-field"></div>
									<select id="ak-exp_date_month" type="text" name="exp_date_month">
										<option value="">MM</option>
										<option value="01">01</option>
										<option value="02">02</option>
										<option value="03">03</option>
										<option value="04">04</option>
										<option value="05">05</option>
										<option value="06">06</option>
										<option value="07">07</option>
										<option value="08">08</option>
										<option value="09">09</option>
										<option value="10">10</option>
										<option value="11">11</option>
										<option value="12">12</option>
									</select>
									<input type="hidden" name="required" value="exp_date_year" id="ak-exp_date_year-required">
									<select id="ak-exp_date_year" type="text" name="exp_date_year">
										<option value="">YYYY</option>
										{% for year in exp_years %}
										<option value="{{ year.two }}">{{ year.four }}</option>
										{% endfor %}
									</select>
								</div>
							</div> <!-- .medium-12 -->

							<div class="medium-12 columns">
								<div id="ak-fieldbox-card_code">
									<input type="hidden" name="required" value="card_code" id="ak-card_code-required">
									<label for="ak-card_code">Verification Code</label>
									<div id="ak-card_code-hosted" class="hosted-field"></div>
									<input id="ak-card_code" type="text" name="card_code" size="4">
								</div>
							</div> <!-- .medium-12 -->
						</div> <!-- .row -->
					</div> <!-- .payment-form -->

					<div class="row">
						<div class="{% if not page.custom_fields.disable_paypal %}medium-12 {% endif %} small-24 submit-button columns">
								{% if page.custom_fields.submit_button_text %}
									<input type="submit" class="button alert" value="{{page.custom_fields.submit_button_text}}" />
								{% else %}
									<input class="button alert" type="submit" value="Submit Donation">
								{% endif %}
						</div> <!-- .submit-button -->                    

						<div class="medium-24 columns form-instructions">
							Click only once to process your donation.<br/><br/>
							<span class="req">*</span>&nbsp;Indicates required field<br/><br/>

							{% if page.custom_fields.donation_template_2 or page.custom_fields.donation_template_3 or page.custom_fields.donation_template_4 %}			
								<div class="ask-text show-for-small columns">
									{% include_tmpl form.ask_text %}
								</div> <!-- .ask-text -->
							{% endif %}

							{% include "./progress_meter.html" %}

							{% comment %}
							<div class="security-seals">
								<!-- GeoTrust QuickSSL [tm] Smart  Icon tag. Do not edit. -->
									<script language="javascript" type="text/javascript" src="//smarticon.geotrust.com/si.js"></script>
								<!-- end  GeoTrust Smart Icon tag -->
							</div> <!-- .security-seals -->
							{% endcomment %}
						</div> <!-- .form-instructions -->
					</div> <!-- .row -->                    
				</div> <!-- .cc-info -->
			</div> <!-- .row -->
		</form>

		{% if not page.custom_fields.disable_paypal %}
			<form id="paypal-form" action="https://www.paypal.com/cgi-bin/webscr" method="POST">
				<input type="hidden" name="cmd" value="_donations">
				
				<input type="hidden" name="on1" value="akid">
				<input type="hidden" id="akid" name="os1">
				
				<input type="hidden" name="on2" value="page_id">
				<input type="hidden" name="os2" value="{{ page.id }}">
				
				<input type="hidden" name="amount" id="paypal-amount">

				<input type="hidden" name="custom" value="{{ page.title }}">

				<input type="hidden" name="business" value="8YLRMFTTWHGB2">
				<input type="hidden" name="lc" value="US">
				<input type="hidden" name="item_name" value="Alaska Wilderness League">

				{% if page.custom_fields.paypal_thank_you_url %}
					<input type="hidden" name="return" value="{{ page.custom_fields.paypal_thank_you_url }}"> 
				{% else %}
					<input type="hidden" name="return" value="http://www.alaskawild.org/thank-you-for-your-support/"> 
				{% endif %}
			</form>
		{% endif %}
	{% comment %}
		/*
			---------------------------------------------------------------
				END - Alternate Layout Donation Form - Markup
			---------------------------------------------------------------
		*/
	{% endcomment %}		
{% else %}
	{% comment %}
		/*
			---------------------------------------------------------------
				START - Classic Layout Donation Form - Markup
			---------------------------------------------------------------
		*/
	{% endcomment %}
	<div class="medium-24 columns page-title">
		<h2>{{ page.title }}</h2>
	</div>

	<div class="small-24 medium-10 columns medium-push-13 page-form">
		<form id="act" name="act" class="donate-form{% if page.payment_processor_information.use_tr %} braintree_form{% endif %}" method="POST" action="/act/" accept-charset="utf-8">
			<input type="hidden" name="orig_akid" value="{{ akid }}">
			<input type="hidden" name="recurring_start" value="{% now "Y-m-d" %}">

				<div class="row">
					<div class="medium-24 columns">
						<div class="form-pretext">
							{% if page.custom_fields.custom_form_title %}{{ page.custom_fields.custom_form_title }}{% else %}Donate!{% endif %}
						</div> <!-- .form-pretext -->

						<div class="errors">
							<ul id="ak-errors"></ul>
						</div> <!-- .errors -->

						{% if has_products %}
							<div id="product_list">
								<label id="products-label" class="ak-label-above">Product{% if products|length > 1 %}s{% endif %}</label>

								<table>
									<tr id="product-table-headers">
										<th id="product-quantity-header">Quantity</th>
										<th id="product-details-header">Product</th>
										<th id="product-amount-header">Price</th>
									</tr>

									{% for product in products %}
										<tr>
											<td class="product-quantity">
												{% ifequal product.max 1 %}
													<input type="checkbox" value="1" name="product_{{ product.id }}" id="product_{{ product.id }}" class="ak_product_inputs" onBlur="update_total()" onChange="update_total()">
												{% else %}
													<input type="text" name="product_{{ product.id }}" id="product_{{ product.id }}" size="2" class="ak_product_inputs" onBlur="update_total()" onChange="update_total()">
												{% endifequal %}
											</td>

											<td class="product-details">
												<div class="product-name">{{ product.name }}</div>

												{% if product.desc %}<div class="product-description">{{ product.desc }}</div>{% endif %}
											</td>

											<td class="product-amount">
												<span id="product_{{ product.id }}_price">{% ifequal product.price 0 %}FREE!{% else %}{{ product.amt|commify }}{% endifequal %}</span>
											</td>
										</tr>
									{% endfor %}
								</table>
							</div> <!-- #product_list -->

							<div id="total_div" class="donation-total">
								<h3>Total Amount: <span id="total"></span></h3>
							</div> <!-- .donation-total -->
						{% endif %}
    
						<div class="amount">
							{% if amounts %}
								<div id="amount_list">
									<h3 class="donate-header">Amount:</h3>
									<table>
										<!-- Should set td's into 3 columns -->
										{% for row in amounts|columns:4 %}
											<tr>
												{% for amount in row %}
													{% ifequal amount "other" %}
														<!-- Other amount will show in its own row below the set amounts -->
													{% else %}
														<td>
															<input type="radio" value="{{ amount }}" class="amount_radio_button" name="amount" onClick="clear_other(); update_total()"  onBlur="update_total()" onChange="update_total()" {% if not args.amount_other and amount == default_amount %}checked{% endif %}>&nbsp;${{ amount }}
														</td>
													{% endifequal %}
												{% endfor %}
											</tr>
										{% endfor %}

										{% for amount in amounts %}
											{% ifequal amount "other" %}
												<tr>
													<td colspan="3">
														<noscript><input type="radio" value="" class="amount_radio_button" name="amount"></noscript>
													
													<!-- logic to enable most_people_are_giving solution -->
													{% if page.custom_fields.most_people_are_giving %}	
														{% if suggested_ask %}
														<div id="suggested_donation" style="margin-bottom: 5%;">
															<span style="font-size: 12px; color: #F57B20; border-bottom: 1px solid #F57B20;">Most people are donating <i class="fa fa-usd" aria-hidden="true"></i>{{ suggested_ask }} right now!</span>
														</div>
														{% else %}
														<div id="suggested_donation" style="margin-bottom: 5%;">
															<span style="font-size: 12px; color: #F57B20; border-bottom: 1px solid #F57B20;">Most people are donating <i class="fa fa-usd" aria-hidden="true"></i>{{ page.custom_fields.most_people_are_giving }} right now!</span>
														</div>
														{% endif %}
													{% endif %}
														
														<div class="other-amount-label">Other $</div><input type="text" id="amount_other_field" name="amount_other" size="3" onFocus="clear_radio_buttons();" onClick="update_total()" onBlur="update_total()" onChange="update_total()">
													</td>
												</tr>
											{% endifequal %}
										{% endfor %}
									</table>

									{% if page.custom_fields.processing_fees_text %}
									<!-- begin checkbox for processing fees -->
									<input type="checkbox" name="include_fees"><span class="include_fees_description">{{ page.custom_fields.processing_fees_text }}</span><br>
									{% endif %}
									
									{% if not has_products %}
										{% if allow_monthly %}
											<div id="type">
												<h3 class="donate-header">Type:</h3>

												<div class="type-wrapper">
													<div class="medium-12 columns">
														<input type="radio" name="donation_type" value="single"{% if page.custom_fields.monthly_default %}{% else %} checked{%endif %}> One-Time
													</div>

													<div id="donation_type_recurring" class="medium-12 columns">
														<input type="radio" name="donation_type" value="recurring"{% if page.custom_fields.monthly_default %} checked{% else %}{%endif %}> Monthly
													</div>
												</div>

												<div class="hidden medium-24 columns paypal-type-notification">
													If your amount is selected just submit below.
												</div>
											</div>										
										{% else %}
											<input type="hidden" name="donation_type" value="single">
										{% endif %}
									{% endif %}
								</div> <!-- #amount_list -->
							{% endif %}
						</div> <!-- .amount -->
					</div> <!-- .medium-24 -->

					{% if show_paypal %}
						<div class="payment-method medium-24 columns">
							<div class="row">
								<div class="medium-12 columns cc">
									<input type="radio" name="paypal" value="0" id="pay_by_cc" checked> 
									<label for="pay_by_cc"><span class="button small">Credit Card</span></label>
								</div>

								<div class="medium-12 columns paypal">
									<input type="radio" name="paypal" value="1" id="pay_by_paypal">
									<label for="pay_by_paypal" class="paypal"><span class="button small">PayPal</span></label>
								</div>
							</div>
						</div>
					{% endif %}

					<div class="medium-24 columns user-info">
						<div class="user-form">
							<div class="user-input box">
								<ul id="ak-errors"></ul>

								<div style="display: none">
									<div id="known_user">
										Not <span id="known_user_name"></span>?  <a href="?" onclick="return actionkit.forms.logOut()">Click here.</a>
									</div>
								</div>

								<div id="unknown_user"></div>

								<div>
									<div class="row">
										<div class="medium-12 columns">
											<label for="first_name">First Name<span id="first_namereq" class="first_namereq req"></span>:</label> 
											<input id="first_name" type="text" name="first_name" />
										</div>

										<div class="medium-12 columns">
											<label for="last_name">Last Name<span id="last_namereq" class="last_namereq req"></span>:</label> 
											<input id="last_name" type="text" name="last_name" />
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="medium-24 columns">
											<label for="address1" class="address">Street<span id="address1req" class="address1req req"></span>:</label>
											<input id="address1" type="text" name="address1" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
										</div>
									</div> <!-- .row -->
                                           
									{% if page.allow_international %}
										<div id="us_billing_fields" class="row">
											<div class="medium-12 columns">
												<label for="state" class="state-label">State<span id="statereq" class="statereq req"></span>:</label> 
												{% with 'sync_to_shipping()' as onchange %}
													{% include "./state_select.html" %}
												{% endwith %}
											</div>

											<div class="medium-12 columns">
												<label for="zip" class="zip-label">Zip<span id="zipreq" class="zipreq req"></span>:</label>  
												<input id="zip"  type="text" name="zip" maxlength="5" size="5" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
											</div>                    
										</div> <!-- #us_billing_fields .row -->

										<div id="intl_billing_fields" class="row">
											<div class="medium-12 columns">
												<label for="state" class="state-label">Region<span id="regionreq" class="regionreq req"></span>:</label> 
												<input id="region"  type="text" name="region" size="20" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
											</div>

											<div class="medium-12 columns">
												<label for="postal" class="zip-label">Postal Code<span id="postalreq" class="postalreq req"></span>:</label>  
												<input id="postal"  type="text" name="postal" size="10" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
											</div>
										</div> <!-- #intl_billing_fields .row -->

										<div class="row">
											<div class="medium-24 columns">
												<label for="state">Country<span id="countryreq" class="countryreq req"></span>:</label> 
												{% with 'country_change()' as onchange %}
													{% include "./country_select.html" %}
												{% endwith %}
											</div>
										</div> <!-- .row -->

										<script language="javascript">country_change();</script>
									{% else %}
										<div class="row">
											<div class="medium-12 columns">
												<label for="city" class="city-label">City<span id="cityreq" class="cityreq req"></span>:</label> 
												<input id="city" type="text" name="city" onchange="sync_to_shipping()" onblur="sync_to_shipping()" />
											</div>

											<div class="medium-6 columns">
												<label for="state" class="state-label">State<span id="statereq" class="statereq req"></span>:</label> 
												{% with 'sync_to_shipping()' as onchange %}
													{% include "./state_select.html" %}
												{% endwith %}
											</div>

											<div class="medium-6 columns">
												<label for="zip" class="zip-label">Zip<span id="zipreq" class="zipreq req"></span>:</label>  
												<input id="zip"  type="text" name="zip" maxlength="5" size="5" onchange="sync_to_shipping()" onblur="sync_to_shipping()"/>
											</div>                    
										</div> <!-- .row -->
									{% endif %}
									
									<div class="row">
										<div class="medium-24 columns">
											<label for="email">Email<span id="emailreq" class="emailreq req"></span>:</label> 
											<input id="email" type="text" name="email" />
											<input type="hidden" name="required" value="email"/>
										</div>
									</div> <!-- .row -->

									<div style="clear"></div>
								</div>

								{% autoescape off %}
									{% if page.custom_fields.custom_field %}
										<div class="clear"></div>
								
										<div class="custom_field">
											{{page.custom_fields.custom_field}}
											
											<div class="clear"></div>
										</div>
									{% endif %}
								{% endautoescape %}

								<input type="hidden" name="page" value="{{ page.name }}">

								<div id="shipping_address"></div>

								{% if has_shippable_products %}
									<hr>
										<h3>Shipping Address</h3>

										{% with "shipping_" as input_name_prefix %}
											<div class="row">
												<div class="medium-24 columns">
													<label for="shipping_address1">Ship to billing address:</label>
													<input id="shipping_same" type="checkbox" name="shipping_same" value="1" onchange="toggle_shipping(this)"/>
												</div>
											</div>

											<div class="row">
												<div class="medium-24 columns">   
													<label for="shipping_address1" class="address">Shipping address:</label>
													<input id="shipping_address1" type="text" name="shipping_address1" /><br>
													<input id="shipping_address2" type="text" name="shipping_address2" />
												</div>
											</div>

											{% if page.allow_international %}
												<div class="row">
													<div class="medium-12 columns">
														<label for="shipping_city">City:</label>
														<input id="shipping_city" type="text" name="shipping_city" />
													</div>

													<div id="us_shipping_fields">
														<div class="medium-6 columns">
															<label for="shipping_state">State:</label>
															{% include "./state_select.html" %}
														</div>

														<div class="medium-6 columns">
															<label for="shipping_zip">Zip:</label>
															<input id="shipping_zip"  type="text" name="shipping_zip" maxlength="5" />
														</div>

														<div id="intl_shipping_fields">
															<div class="medium-12 columns">
																<label for="shipping_region">Region:</label>
																<input id="shipping_region"  type="text" name="shipping_region" />
															</div>

															<div class="medium-12 columns">
																<label for="shipping_postal">Postal Code:</label>
																<input id="shipping_postal"  type="text" name="shipping_postal" />
															</div>
														</div>
													</div>
												</div>

												<div class="row">
													<div class="medium-24 columns">
														<label for="state">Country:</label> {% with 'shipping_country_change()' as onchange %}{% include "./country_select.html" %}{% endwith %}
													</div>

													<script language="javascript">shipping_country_change();</script>
												</div>
											{% else %}
												<div id="us_shipping_fields" class="row">
													<div class="medium-12 columns">
														<label for="shipping_city">City:</label>
														<input id="shipping_city" type="text" name="shipping_city" />
													</div>

													<div class="medium-6 columns">
														<label for="shipping_state">State:</label>
														{% include "./state_select.html" %}
													</div>

													<div class="medium-6 columns">
														<label for="shipping_zip">Zip:</label>
														<input id="shipping_zip"  type="text" name="shipping_zip" maxlength="5" />
													</div>
												</div>   
											{% endif %}       
										{% endwith %}
									{% endif %}
								</div> <!-- .user_input .box -->
							</div> <!-- .user-form -->
						</div> <!-- .user-info -->

						<div class="medium-24 columns cc-info">
							<div class="payment-form">
								<div class="row">
									<div class="medium-24 columns">
										<div id="ak-fieldbox-card_num" class="">
											<label for="ak-card_num">Credit Card #</label>
											<input type="hidden" name="required" value="card_num" id="ak-card_num-required">
											<div id="ak-card_num-hosted" class="hosted-field"></div>
											<input id="ak-card_num" type="text" name="card_num">
										</div>
									</div>
								</div> <!-- .row -->

								<div class="row">
									<div class="medium-12 columns">
										<div id="ak-fieldbox-exp_date">
											<input type="hidden" name="required" value="exp_date_month" id="ak-exp_date_month-required">
											<label for="ak-exp_date_month">Expiration Date</label>
											<div id="ak-exp_date-hosted" class="hosted-field"></div>
											<select id="ak-exp_date_month" type="text" name="exp_date_month">
												<option value="">MM</option>
												<option value="01">01</option>
												<option value="02">02</option>
												<option value="03">03</option>
												<option value="04">04</option>
												<option value="05">05</option>
												<option value="06">06</option>
												<option value="07">07</option>
												<option value="08">08</option>
												<option value="09">09</option>
												<option value="10">10</option>
												<option value="11">11</option>
												<option value="12">12</option>
											</select>
											<input type="hidden" name="required" value="exp_date_year" id="ak-exp_date_year-required">
											<select id="ak-exp_date_year" type="text" name="exp_date_year">
												<option value="">YYYY</option>
												{% for year in exp_years %}
												<option value="{{ year.two }}">{{ year.four }}</option>
												{% endfor %}
											</select>
										</div>
									</div>

									<div class="medium-12 columns">
										<div id="ak-fieldbox-card_code">
											<input type="hidden" name="required" value="card_code" id="ak-card_code-required">
											<label for="ak-card_code">Verification Code</label>
											<div id="ak-card_code-hosted" class="hosted-field"></div>
											<input id="ak-card_code" type="text" name="card_code" size="4">
										</div>
									</div>
								</div> <!-- .row --> 
							</div>
						</div>

						<div class="small-24 submit-button columns">
								{% if page.custom_fields.submit_button_text %}
									<input type="submit" class="button alert" value="{{page.custom_fields.submit_button_text}}" />
								{% else %}
									<input class="button alert" type="submit" value="Submit Donation">
								{% endif %}
							<div>{% include "./progress_meter.html" %}</div>
						</div>
					</div>
				</form>
			</div> <!-- page-form -->

			<div class="small-24 medium-12 medium-pull-11 medium-offset-1 columns page-text">
				{% include_tmpl form.ask_text %}
			</div> <!-- page-text -->
{% comment %}
	/*
-------------------------------------------------------------------------------
	@END - Classic Layout Donation Form - Markup
-------------------------------------------------------------------------------
	*/
{% endcomment %}
{% endif %}
{% comment %}
	/*
-------------------------------------------------------------------------------
		@START - PayPal Integration Script
-------------------------------------------------------------------------------
	*/
{% endcomment %}
{% if show_paypal %}
	<script>
		function submit_paypal() {
			/* clear out CC info if entered */
			$('#card_num').val('');
			$('#card_code').val('');

			/* and keep submitting */
			return True;
		}

		function paypalradios() {
			$(".ak-cc-box").addClass('ak-hide');

			$( "input[type='radio'][name='paypal']").click(function() {
				console.log('click');

				if ($("#pay_by_cc").is(':checked')) {
					$(".payment-form").slideDown();
					$('.paypal-type-notification').slideUp();
					$('.type-wrapper').slideDown();
				}

				if ($("#pay_by_paypal").is(':checked')) {
					$(".payment-form").slideUp();
					$('input[name="donation_type"][value="single"]').prop("checked", true);
					$('.type-wrapper').slideUp();
					$('.paypal-type-notification').slideDown();
				}
			}); 
		
			if ($("#pay_by_cc").is(':checked')) {
				$(".payment-form").show()
			}

			$( 'input[name="donation_type"]' ).click( function() {
				if( $(this).val() == "recurring" ) {
					$( '.payment-method .paypal' ).fadeOut( 300 );
					$( '#pay_by_cc' ).click();
				} else {
					$( '.payment-method .paypal' ).fadeIn( 300 );
				}
			});
		}
/*
		$(document).ready(function() {
			paypalradios();
		});
*/
		paypalradios();

	</script>
{% endif %}
{% comment %}
	/*
-------------------------------------------------------------------------------
		@END - PayPal Integration Script
-------------------------------------------------------------------------------
	*/
{% endcomment %}

<!-- BEGIN script for processing fee checkbox -->
<script>
	$( document ).ready(function() {
		var amount_selected = $('input[name="amount"]:checked').val();
		var amount_other = $('input[name="amount_other"]').val();
		var real_amount = Number(amount_selected) + Number(amount_other);
		
		var processing_fee = ((real_amount*0.029) + 0.30);
		grand_total = (processing_fee + real_amount).toFixed(2);
		
		console.log( grand_total );
		
		//set checkbox to checked
		{% ifequal page.custom_fields.include_processing_fees_donation_pages "checked" %}
			$('input[name="include_fees"]').prop('checked', true);
		{% endifequal %}

		//change function for radio amounts
		$('input[name="amount"]').click(function() {
			var amount_selected = $('input[name="amount"]:checked').val();
			var real_amount = Number(amount_selected);
			
			var processing_fee = ((real_amount*0.029) + 0.30);
			grand_total = (processing_fee + real_amount).toFixed(2);
			
			$('input[name="include_fees"]').prop('checked', false);
			
		});
		
		//make sure if page loads with radio button checked, fees checkbox is unchecked automatically
		if ($('input.amount_radio_button').is(':checked')) {
			$('input[name="include_fees"]').prop('checked', false);
		}
	});
	
	//change function for other amount field
	$('input[name="amount_other"]').change(function() {
			var amount_other = $('input[name="amount_other"]').val();
			var real_amount = Number(amount_other);
			
			var processing_fee = ((real_amount*0.029) + 0.30);
			grand_total = (processing_fee + real_amount).toFixed(2);
			
		});
	
	$("input").change(function() {
		if ($('input[name="include_fees"]').is(':checked')) {
				//console.log("checked!");
				$('input#amount_other_field').val( grand_total );
			}
			else {
				//console.log("not checked!");
			}
		});
		
	$("input[name=include_fees]").change(function() {
		if ($('input[name="include_fees"]').is(':checked')) {
			clear_radio_buttons();
		} else {
			clear_other();
		}
	});
<!-- END script for processing fee checkbox -->
<!-- BEGIN script for suggested contribution amount -->
	$( document ).ready(function() {
		console.log();
	});

<!-- END script for suggested contribution amount -->
</script>

{% if page.custom_fields.recurring_donation_popup %}
	<script>
	<!-- START script for recurring donation ask modal (see line 5 for modal code) -->
		<!-- START script for recurring donation ask form submission -->
		$('#recurring_submit').click(function() {
			submit_ticker = 1;
			$('#recurringModal').foundation('reveal','close');
			actionkit.donations.tokenizeAndSubmit();
		});
		<!-- END script for recurring donation ask form submission -->

		<!-- START script for setting recurring donation on "YES" from modal -->
		$(document).ready(function() {
			$('#recurring_confirm').click(function() {
				submit_ticker = 1;
				clear_radio_buttons(); //function for clearing radio amount selected
				$('#amount_other_field').val(recurring_amount); //changes donation amount to reflect updated recurring donation
				//$('#amount_other_field').effect("highlight", {color: '#D9610A'}, 2000);
				$('input[value="recurring"]').attr('checked', true); //changes type to monthly
				//$('#donation_type_recurring').effect("highlight", {color: '#D9610A'}, 2000);
				//$("html, body").animate({ scrollTop: 0 }, "slow");
				actionkit.donations.tokenizeAndSubmit();
			});
		});
		<!-- END script for setting recurring donation on "YES" from modal -->

		function actionkitBeforeSubmit() {	
			console.log(submit_ticker);

			if(submit_ticker != 1 && !$("#pay_by_paypal").is(':checked')) {
				var amount_selected = $('input[name="amount"]:checked').val();
				var amount_other = Number($('input[name="amount_other"]').val());
				
				//function to properly define real_amount in one variable depending on if there are selected checkboxes
				if (amount_selected == null) {
					var real_amount = amount_other;
				} else {
					var real_amount = Number(amount_selected);
				}
				
				if ($('input[value="single"]').prop('checked')) {
					console.log("real amount=" + real_amount);
					
					if (real_amount >= 20 && real_amount < 50) {
						console.log(">20 & <50");
						recurring_amount = 5;
						$( "span#recurring_donation_suggest" ).html( recurring_amount );
						$( "span#real_amount" ).html( real_amount.toFixed(2) );
						$('#recurringModal').foundation('reveal','open');
						return false;
						
					} else if (real_amount >50) {
						console.log(">50");
						recurring_amount = (real_amount*.10).toFixed(2);
						$( "span#recurring_donation_suggest" ).html( recurring_amount );
						$( "span#real_amount" ).html( real_amount.toFixed(2) );
						$('#recurringModal').foundation('reveal','open');
						return false;
					} else {
						console.log("below recurring ask threshold");
						return true;
					}
				}
			}
		};

		var submit_ticker = 0;
	<!-- END script for recurring donation ask modal -->
	</script>
{% endif %}

<!-- test block just to address pay_by_paypal issue -->
<script>
$("body").click(function() {
 if ($("#pay_by_paypal").not(':checked')) {
	console.log("not checked");
 } else {
	console.log("checked");
 }
});
</script>
<!-- END test block  -->

<!-- begin use_vzero block -->
{% with page.payment_processor_information as pp %}
{% if pp.use_vzero %}
<style type="text/css">
.hosted-field {
    height: 2.375em;
    padding: 7px 7px;
    margin-bottom: 6px;
    background-color: white;
    border: 1px solid #ccc;
}
.hosted-field.braintree-hosted-fields-invalid {
    border-color: {{ templateset.custom_fields.color_error|default:"#d00" }};
    background-color: #FFC8C8;
}
</style>
<script src="https://js.braintreegateway.com/web/3.5.0/js/client.min.js"></script>
<script src="https://js.braintreegateway.com/web/3.5.0/js/hosted-fields.min.js"></script>
<script src="https://js.braintreegateway.com/web/3.5.0/js/data-collector.min.js"></script>
<script src="/resources/ak_braintree_vzero.js"></script>
<script>
$(function() {
    var form = document.querySelector("#act"),
        options = {
            form: form,
            fields: {
                number: {
                    selector: '#ak-card_num-hosted'
                },
                cvv: {
                    selector: '#ak-card_code-hosted'
                },
                expirationDate: {
                    selector: '#ak-exp_date-hosted',
                    placeholder: 'MM / YYYY'
                }
            },
            styles: {
                'input': {
                    'font-family': '{{ templateset.custom_fields.font_family|default:"sans-serif"|safe }}',
                    'font-size': '{{ templateset.custom_fields.font_size|default:"16.5px" }}',
                    'color': '#4b4b4b'
                },
                'input.invalid': {
                    'color': '{{templateset.custom_fields.color_error|default:"#d00" }}',
                    'background-color': '#FFC8C8'
                },
                'input.valid': {
                    'color': 'green'
                }
            },
            submitOnEmpty: function() {
                return $('#pay_by_paypal:checked').val() == 1;
            },
            submit: form.querySelector(".ak-submit-button")
        },
        toRemove = ["#ak-card_num", "#ak-card_code", "#ak-exp_date_month",
                    "#ak-exp_date_year", "#ak-card_num-required",
                    "#ak-card_code-required", "#ak-exp_date_month-required",
                    "#ak-exp_date_year-required"];

    toRemove.forEach(function(el) {
        $(el).remove();
    });

    actionkit.donations.handleError = function(err) {
        if (window.console) {
            window.console.log(err);
        }

        if (!actionkit.errors) {
            actionkit.errors = {};
        }

        switch (err.code) {
            case 'HOSTED_FIELDS_FIELDS_EMPTY':
                actionkit.errors['card_num:invalid'] = "Credit card fields are empty.";
                break;
          case 'HOSTED_FIELDS_FIELDS_INVALID':
                err.details.invalidFieldKeys.forEach(function(key) {
                    var map = {
                        'number': 'card_num',
                        'cvv': 'card_code',
                        'expirationDate': 'card_exp'
                    };
                    actionkit.errors[map[key] + ':invalid'] = "This field is invalid.";;
                });
                break;
          case 'HOSTED_FIELDS_FAILED_TOKENIZATION':
                actionkit.errors['card_num:invalid'] = "Please check that your credit card is valid.";
                break;
          case 'HOSTED_FIELDS_TOKENIZATION_NETWORK_ERROR':
                actionkit.errors['card_num:invalid'] = "Network error.";
                break;
          default:
                actionkit.errors['card_num:invalid'] = "An error occurred: " + err.message;
        }
        actionkit.forms.onValidationErrors(actionkit.errors);
    };

    actionkit.donations.tokenizeOnSubmit = function(hostedFieldsInstance, options) {
        actionkit.donations.tokenizeAndSubmit = function() {
            hostedFieldsInstance.tokenize(function (tokenizeErr, payload) {
                if (tokenizeErr) {
                    if (options.submitOnEmpty && options.submitOnEmpty() &&
                            tokenizeErr.code == 'HOSTED_FIELDS_FIELDS_EMPTY') {
                        options.form.submit();
                    } else {
                        actionkit.donations.handleError(tokenizeErr);
                    }
                    return;
                }
                actionkit.donations.addHiddenInput(options.form, 'payment_method_nonce', payload.nonce);
                options.form.submit();
            });
        };
    };

    actionkit.donations.initClient('{{ pp.client_token }}', options);

    // read by 3-step validation
    actionkit.donations.skip_cc_validation = true;
    actionkit.donations.vzero = true;

    form.onsubmit = function(evt) {
        evt.preventDefault();
        actionkit.forms.setForm("act");
        var res = actionkit.forms.tryToValidate();
        if (res !== false) {
            actionkit.donations.tokenizeAndSubmit();
        }
        return res;
    }
});
</script>
{% endif %}
{% endwith %}
<!-- end use_vzero block  -->

{% endblock %}

{% block footer %}
{% endblock %}
<!-- @END donate.html -->